local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local Catlib = {}
Catlib.__index = Catlib

local function Create(class, props)
    local inst = Instance.new(class)
    for i,v in pairs(props) do
        if i ~= "Parent" then
            inst[i] = v
        end
    end
    inst.Parent = props.Parent
    return inst
end

local function Tween(obj,props,time,style,dir)
    local t = TweenService:Create(obj,TweenInfo.new(time or .4,style or Enum.EasingStyle.Quad,dir or Enum.EasingDirection.Out),props)
    t:Play()
    return t
end

function Catlib:Loading(config)
    config = config or {}
    local mode = config.Mode or "Modern"
    local icon = config.Icon
    local title = config.Title
    local barColor = config.LoadingBarColor or Color3.fromRGB(255,255,255)
    local textColor = config.TextColor or Color3.fromRGB(255,255,255)

    local gui = Create("ScreenGui",{Name="CatlibLoading",Parent=CoreGui,IgnoreGuiInset=true,ResetOnSpawn=false,ZIndexBehavior=Enum.ZIndexBehavior.Sibling})

    local frame = Create("Frame",{
        Parent=gui,
        Size=UDim2.fromOffset(620,340),
        Position=UDim2.fromScale(.5,.5),
        AnchorPoint=Vector2.new(.5,.5),
        BackgroundColor3=Color3.fromRGB(22,22,22),
        BorderSizePixel=0
    })

    Create("UICorner",{Parent=frame,CornerRadius=UDim.new(0,8)})

    local iconObj
    if icon then
        iconObj = Create("ImageLabel",{
            Parent=frame,
            BackgroundTransparency=1,
            Size=UDim2.fromOffset(90,90),
            Position=UDim2.fromScale(.5,.32),
            AnchorPoint=Vector2.new(.5,.5),
            Image=icon
        })
    end

    local titleObj
    if title then
        titleObj = Create("TextLabel",{
            Parent=frame,
            BackgroundTransparency=1,
            Size=UDim2.fromOffset(500,40),
            Position=UDim2.fromScale(.5,.52),
            AnchorPoint=Vector2.new(.5,.5),
            Text=title,
            Font=Enum.Font.GothamBold,
            TextSize=28,
            TextColor3=textColor
        })
    end

    local loadingText = Create("TextLabel",{
        Parent=frame,
        BackgroundTransparency=1,
        Size=UDim2.fromOffset(400,30),
        Position=UDim2.fromScale(.5,.66),
        AnchorPoint=Vector2.new(.5,.5),
        Text="Loading...",
        Font=Enum.Font.Gotham,
        TextSize=18,
        TextColor3=textColor
    })

    local barBG = Create("Frame",{
        Parent=frame,
        Size=UDim2.fromOffset(520,4),
        Position=UDim2.fromScale(.5,.85),
        AnchorPoint=Vector2.new(.5,.5),
        BackgroundColor3=Color3.fromRGB(45,45,45),
        BorderSizePixel=0
    })

    local bar = Create("Frame",{
        Parent=barBG,
        Size=UDim2.new(0,0,1,0),
        BackgroundColor3=barColor,
        BorderSizePixel=0
    })

    if mode=="Modern" then
        frame.BackgroundTransparency=1
        if iconObj then iconObj.ImageTransparency=1 end
        if titleObj then titleObj.TextTransparency=1 end
        loadingText.TextTransparency=1
        barBG.BackgroundTransparency=1
        bar.BackgroundTransparency=1

        task.wait(.2)
        Tween(frame,{BackgroundTransparency=0},.6,Enum.EasingStyle.Quint)
        task.wait(.2)
        if iconObj then Tween(iconObj,{ImageTransparency=0},.5) end
        if titleObj then Tween(titleObj,{TextTransparency=0},.5) end
        Tween(loadingText,{TextTransparency=0},.5)
        Tween(barBG,{BackgroundTransparency=0},.5)
        Tween(bar,{BackgroundTransparency=0},.5)

        task.wait(.6)
        Tween(bar,{Size=UDim2.new(1,0,1,0)},2.2,Enum.EasingStyle.Linear)
        task.wait(2.3)

        if iconObj then Tween(iconObj,{ImageTransparency=1},.4) end
        if titleObj then Tween(titleObj,{TextTransparency=1},.4) end
        Tween(loadingText,{TextTransparency=1},.4)
        Tween(barBG,{BackgroundTransparency=1},.4)
        Tween(bar,{BackgroundTransparency=1},.4)
        task.wait(.4)
        Tween(frame,{BackgroundTransparency=1},.5,Enum.EasingStyle.Quint,Enum.EasingDirection.In)
        task.wait(.6)
        gui:Destroy()
    else
        local overlay = Create("Frame",{Parent=gui,Size=UDim2.new(1,0,0,0),BackgroundColor3=Color3.fromRGB(15,15,15),BorderSizePixel=0})
        frame.BackgroundTransparency=1
        if iconObj then iconObj.ImageTransparency=1 end
        if titleObj then titleObj.TextTransparency=1 end
        loadingText.TextTransparency=1
        barBG.BackgroundTransparency=1
        bar.BackgroundTransparency=1

        Tween(overlay,{Size=UDim2.new(1,0,1,0)},.5)
        task.wait(.3)
        Tween(frame,{BackgroundTransparency=0},.4)
        if iconObj then Tween(iconObj,{ImageTransparency=0},.4) end
        if titleObj then Tween(titleObj,{TextTransparency=0},.4) end
        Tween(loadingText,{TextTransparency=0},.4)
        Tween(barBG,{BackgroundTransparency=0},.4)
        Tween(bar,{BackgroundTransparency=0},.4)

        task.wait(.5)
        Tween(bar,{Size=UDim2.new(1,0,1,0)},2.2,Enum.EasingStyle.Linear)
        task.wait(2.3)

        if iconObj then Tween(iconObj,{ImageTransparency=1},.3) end
        if titleObj then Tween(titleObj,{TextTransparency=1},.3) end
        Tween(loadingText,{TextTransparency=1},.3)
        Tween(barBG,{BackgroundTransparency=1},.3)
        Tween(bar,{BackgroundTransparency=1},.3)
        Tween(frame,{BackgroundTransparency=1},.4)
        Tween(overlay,{Size=UDim2.new(1,0,0,0)},.5,Enum.EasingDirection.In)
        task.wait(.6)
        gui:Destroy()
    end
end

function Catlib:KeySystem(config)
    config=config or {}
    local mode=config.Mode or "Modern"
    local icon=config.Icon
    local title=config.Title
    local borderColor=config.BorderColor or Color3.fromRGB(255,255,255)
    local textColor=config.TextColor or Color3.fromRGB(255,255,255)
    local key=config.Key or ""
    local onSuccess=config.OnSuccess or function()end

    local gui=Create("ScreenGui",{Name="CatlibKey",Parent=CoreGui,IgnoreGuiInset=true,ResetOnSpawn=false,ZIndexBehavior=Enum.ZIndexBehavior.Sibling})

    local frame=Create("Frame",{Parent=gui,Size=UDim2.fromOffset(680,420),Position=UDim2.fromScale(.5,.5),AnchorPoint=Vector2.new(.5,.5),BackgroundColor3=Color3.fromRGB(22,22,22),BorderSizePixel=0})
    Create("UICorner",{Parent=frame,CornerRadius=UDim.new(0,8)})

    local iconObj
    if icon then
        iconObj=Create("ImageLabel",{Parent=frame,BackgroundTransparency=1,Size=UDim2.fromOffset(90,90),Position=UDim2.fromScale(.5,.23),AnchorPoint=Vector2.new(.5,.5),Image=icon})
    end

    local titleObj
    if title then
        titleObj=Create("TextLabel",{Parent=frame,BackgroundTransparency=1,Size=UDim2.fromOffset(500,45),Position=UDim2.fromScale(.5,.4),AnchorPoint=Vector2.new(.5,.5),Text=title,Font=Enum.Font.GothamBold,TextSize=30,TextColor3=textColor})
    end

    local inputLabel=Create("TextLabel",{Parent=frame,BackgroundTransparency=1,Size=UDim2.fromOffset(560,25),Position=UDim2.fromScale(.5,.55),AnchorPoint=Vector2.new(.5,.5),Text="Input Key",Font=Enum.Font.Gotham,TextSize=17,TextColor3=textColor,TextXAlignment=Enum.TextXAlignment.Left})

    local line=Create("Frame",{Parent=frame,Size=UDim2.fromOffset(560,1),Position=UDim2.fromScale(.5,.585),AnchorPoint=Vector2.new(.5,.5),BackgroundColor3=borderColor,BorderSizePixel=0})

    local box=Create("TextBox",{Parent=frame,Size=UDim2.fromOffset(560,35),Position=UDim2.fromScale(.5,.6),AnchorPoint=Vector2.new(.5,0),BackgroundTransparency=1,Text="",TextColor3=textColor,Font=Enum.Font.Gotham,TextSize=16,TextXAlignment=Enum.TextXAlignment.Left,ClearTextOnFocus=false})

    local getBtn=Create("TextButton",{Parent=frame,Size=UDim2.fromOffset(200,50),Position=UDim2.fromScale(.32,.85),AnchorPoint=Vector2.new(.5,.5),BackgroundColor3=Color3.fromRGB(22,22,22),Text="Get Key",Font=Enum.Font.GothamBold,TextSize=18,TextColor3=textColor,BorderSizePixel=0})
    Create("UIStroke",{Parent=getBtn,Color=borderColor,Thickness=2})

    local confirmBtn=Create("TextButton",{Parent=frame,Size=UDim2.fromOffset(200,50),Position=UDim2.fromScale(.68,.85),AnchorPoint=Vector2.new(.5,.5),BackgroundColor3=Color3.fromRGB(22,22,22),Text="Confirm",Font=Enum.Font.GothamBold,TextSize=18,TextColor3=textColor,BorderSizePixel=0})
    Create("UIStroke",{Parent=confirmBtn,Color=borderColor,Thickness=2})

    confirmBtn.MouseButton1Click:Connect(function()
        if box.Text==key then
            Tween(frame,{BackgroundTransparency=1},.5)
            task.wait(.5)
            gui:Destroy()
            onSuccess()
        else
            box.Text=""
            box.PlaceholderText="Invalid Key"
            task.wait(1)
            box.PlaceholderText=""
        end
    end)

    if mode=="Modern" then
        frame.BackgroundTransparency=1
        if iconObj then iconObj.ImageTransparency=1 end
        if titleObj then titleObj.TextTransparency=1 end
        inputLabel.TextTransparency=1
        line.BackgroundTransparency=1
        box.TextTransparency=1
        getBtn.TextTransparency=1 getBtn.BackgroundTransparency=1
        confirmBtn.TextTransparency=1 confirmBtn.BackgroundTransparency=1

        task.wait(.2)
        Tween(frame,{BackgroundTransparency=0},.6,Enum.EasingStyle.Quint)
        task.wait(.2)
        if iconObj then Tween(iconObj,{ImageTransparency=0},.5) end
        if titleObj then Tween(titleObj,{TextTransparency=0},.5) end
        Tween(inputLabel,{TextTransparency=0},.5)
        Tween(line,{BackgroundTransparency=0},.5)
        Tween(box,{TextTransparency=0},.5)
        Tween(getBtn,{TextTransparency=0,BackgroundTransparency=0},.5)
        Tween(confirmBtn,{TextTransparency=0,BackgroundTransparency=0},.5)
    else
        local overlay=Create("Frame",{Parent=gui,Size=UDim2.new(1,0,0,0),BackgroundColor3=Color3.fromRGB(15,15,15),BorderSizePixel=0})
        frame.BackgroundTransparency=1
        Tween(overlay,{Size=UDim2.new(1,0,1,0)},.5)
        task.wait(.3)
        Tween(frame,{BackgroundTransparency=0},.4)
    end
end

return Catlib
