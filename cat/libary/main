local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

local Catlib = {}
Catlib.__index = Catlib

local function CreateInstance(class, properties)
    local instance = Instance.new(class)
    for property, value in pairs(properties) do
        if property ~= "Parent" then
            instance[property] = value
        end
    end
    if properties.Parent then
        instance.Parent = properties.Parent
    end
    return instance
end

local function Tween(object, properties, duration, style, direction)
    local tweenInfo = TweenInfo.new(duration or 0.3, style or Enum.EasingStyle.Quad, direction or Enum.EasingDirection.Out)
    local tween = TweenService:Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

function Catlib:CreateLoadingScreen(config)
    config = config or {}
    local mode = config.Mode or "modern"
    local icon = config.Icon
    local title = config.Title
    local loadingBarColor = config.LoadingBarColor or Color3.fromRGB(255, 255, 255)
    local textColor = config.TextColor or Color3.fromRGB(255, 255, 255)
    
    local screenGui = CreateInstance("ScreenGui", {
        Name = "CatlibLoadingScreen",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false,
        IgnoreGuiInset = true
    })
    
    local mainFrame = CreateInstance("Frame", {
        Name = "MainFrame",
        Size = UDim2.new(0, 650, 0, 380),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(25, 25, 25),
        BorderSizePixel = 0,
        Parent = screenGui
    })
    
    CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 0),
        Parent = mainFrame
    })
    
    local iconLabel
    if icon then
        iconLabel = CreateInstance("ImageLabel", {
            Name = "Icon",
            Size = UDim2.new(0, 100, 0, 100),
            Position = UDim2.new(0.5, 0, 0.25, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Image = icon,
            Parent = mainFrame
        })
    end
    
    local titleLabel
    if title then
        titleLabel = CreateInstance("TextLabel", {
            Name = "Title",
            Size = UDim2.new(0, 500, 0, 50),
            Position = UDim2.new(0.5, 0, 0.48, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Text = title,
            TextColor3 = textColor,
            TextSize = 28,
            Font = Enum.Font.GothamBold,
            Parent = mainFrame
        })
    end
    
    local loadingText = CreateInstance("TextLabel", {
        Name = "LoadingText",
        Size = UDim2.new(0, 500, 0, 35),
        Position = UDim2.new(0.5, 0, 0.64, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Text = "Loading...",
        TextColor3 = textColor,
        TextSize = 20,
        Font = Enum.Font.Gotham,
        Parent = mainFrame
    })
    
    local loadingBarBackground = CreateInstance("Frame", {
        Name = "LoadingBarBackground",
        Size = UDim2.new(0, 550, 0, 6),
        Position = UDim2.new(0.5, 0, 0.8, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(45, 45, 45),
        BorderSizePixel = 0,
        Parent = mainFrame
    })
    
    CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 0),
        Parent = loadingBarBackground
    })
    
    local loadingBar = CreateInstance("Frame", {
        Name = "LoadingBar",
        Size = UDim2.new(0, 0, 1, 0),
        BackgroundColor3 = loadingBarColor,
        BorderSizePixel = 0,
        Parent = loadingBarBackground
    })
    
    CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 0),
        Parent = loadingBar
    })
    
    if mode == "modern" then
        mainFrame.BackgroundTransparency = 1
        if iconLabel then iconLabel.ImageTransparency = 1 end
        if titleLabel then titleLabel.TextTransparency = 1 end
        loadingText.TextTransparency = 1
        loadingBarBackground.BackgroundTransparency = 1
        loadingBar.BackgroundTransparency = 1
        
        task.spawn(function()
            task.wait(0.1)
            
            Tween(mainFrame, {BackgroundTransparency = 0}, 0.8, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
            
            task.wait(0.3)
            
            if iconLabel then
                Tween(iconLabel, {ImageTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            end
            if titleLabel then
                Tween(titleLabel, {TextTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            end
            Tween(loadingText, {TextTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(loadingBarBackground, {BackgroundTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(loadingBar, {BackgroundTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            
            task.wait(0.6)
            
            local loadingDuration = 2.5
            Tween(loadingBar, {Size = UDim2.new(1, 0, 1, 0)}, loadingDuration, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
            
            task.wait(loadingDuration)
            task.wait(0.3)
            
            if iconLabel then
                Tween(iconLabel, {ImageTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            end
            if titleLabel then
                Tween(titleLabel, {TextTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            end
            Tween(loadingText, {TextTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            Tween(loadingBarBackground, {BackgroundTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            Tween(loadingBar, {BackgroundTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            
            task.wait(0.5)
            
            Tween(mainFrame, {BackgroundTransparency = 1}, 0.6, Enum.EasingStyle.Quint, Enum.EasingDirection.In)
            
            task.wait(0.7)
            screenGui:Destroy()
        end)
        
    else
        local backgroundOverlay = CreateInstance("Frame", {
            Name = "BackgroundOverlay",
            Size = UDim2.new(1, 0, 0, 0),
            Position = UDim2.new(0, 0, 0, 0),
            BackgroundColor3 = Color3.fromRGB(15, 15, 15),
            BorderSizePixel = 0,
            ZIndex = 0,
            Parent = screenGui
        })
        
        mainFrame.BackgroundTransparency = 1
        if iconLabel then iconLabel.ImageTransparency = 1 end
        if titleLabel then titleLabel.TextTransparency = 1 end
        loadingText.TextTransparency = 1
        loadingBarBackground.BackgroundTransparency = 1
        loadingBar.BackgroundTransparency = 1
        
        task.spawn(function()
            task.wait(0.1)
            
            Tween(backgroundOverlay, {Size = UDim2.new(1, 0, 1, 0)}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            
            task.wait(0.3)
            
            Tween(mainFrame, {BackgroundTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            
            if iconLabel then
                Tween(iconLabel, {ImageTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            end
            if titleLabel then
                Tween(titleLabel, {TextTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            end
            Tween(loadingText, {TextTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(loadingBarBackground, {BackgroundTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(loadingBar, {BackgroundTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            
            task.wait(0.4)
            
            local loadingDuration = 2.5
            Tween(loadingBar, {Size = UDim2.new(1, 0, 1, 0)}, loadingDuration, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
            
            task.wait(loadingDuration)
            task.wait(0.3)
            
            if iconLabel then
                Tween(iconLabel, {ImageTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            end
            if titleLabel then
                Tween(titleLabel, {TextTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            end
            Tween(loadingText, {TextTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            Tween(loadingBarBackground, {BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            Tween(loadingBar, {BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            
            task.wait(0.4)
            
            Tween(mainFrame, {BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            Tween(backgroundOverlay, {Size = UDim2.new(1, 0, 0, 0)}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
            
            task.wait(0.6)
            screenGui:Destroy()
        end)
    end
end

function Catlib:CreateKeySystem(config)
    config = config or {}
    local mode = config.Mode or "modern"
    local icon = config.Icon
    local title = config.Title
    local borderColor = config.BorderColor or Color3.fromRGB(255, 255, 255)
    local textColor = config.TextColor or Color3.fromRGB(255, 255, 255)
    local correctKey = config.Key or ""
    local getKeyUrl = config.GetKeyUrl or ""
    local onSuccess = config.OnSuccess or function() end
    
    local screenGui = CreateInstance("ScreenGui", {
        Name = "CatlibKeySystem",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false,
        IgnoreGuiInset = true
    })
    
    local mainFrame = CreateInstance("Frame", {
        Name = "MainFrame",
        Size = UDim2.new(0, 650, 0, 420),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(25, 25, 25),
        BorderSizePixel = 0,
        Parent = screenGui
    })
    
    CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 0),
        Parent = mainFrame
    })
    
    local iconLabel
    if icon then
        iconLabel = CreateInstance("ImageLabel", {
            Name = "Icon",
            Size = UDim2.new(0, 100, 0, 100),
            Position = UDim2.new(0.5, 0, 0.2, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Image = icon,
            Parent = mainFrame
        })
    end
    
    local titleLabel
    if title then
        titleLabel = CreateInstance("TextLabel", {
            Name = "Title",
            Size = UDim2.new(0, 500, 0, 50),
            Position = UDim2.new(0.5, 0, 0.42, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1,
            Text = title,
            TextColor3 = textColor,
            TextSize = 28,
            Font = Enum.Font.GothamBold,
            Parent = mainFrame
        })
    end
    
    local inputKeyLabel = CreateInstance("TextLabel", {
        Name = "InputKeyLabel",
        Size = UDim2.new(0, 500, 0, 30),
        Position = UDim2.new(0.5, 0, 0.56, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Text = "Input Key",
        TextColor3 = textColor,
        TextSize = 18,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = mainFrame
    })
    
    local inputBorder = CreateInstance("Frame", {
        Name = "InputBorder",
        Size = UDim2.new(0, 500, 0, 2),
        Position = UDim2.new(0.5, 0, 0.6, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = borderColor,
        BorderSizePixel = 0,
        Parent = mainFrame
    })
    
    local keyInput = CreateInstance("TextBox", {
        Name = "KeyInput",
        Size = UDim2.new(0, 500, 0, 40),
        Position = UDim2.new(0.5, 0, 0.65, 0),
        AnchorPoint = Vector2.new(0.5, 0),
        BackgroundTransparency = 1,
        Text = "",
        PlaceholderText = "",
        TextColor3 = textColor,
        TextSize = 16,
        Font = Enum.Font.Gotham,
        ClearTextOnFocus = false,
        Parent = mainFrame
    })
    
    local buttonContainer = CreateInstance("Frame", {
        Name = "ButtonContainer",
        Size = UDim2.new(0, 520, 0, 60),
        Position = UDim2.new(0.5, 0, 0.82, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Parent = mainFrame
    })
    
    local getKeyButton = CreateInstance("TextButton", {
        Name = "GetKeyButton",
        Size = UDim2.new(0, 180, 0, 50),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Color3.fromRGB(35, 35, 35),
        BorderSizePixel = 0,
        Text = "Get Key",
        TextColor3 = textColor,
        TextSize = 18,
        Font = Enum.Font.GothamBold,
        Parent = buttonContainer
    })
    
    CreateInstance("UIStroke", {
        Color = borderColor,
        Thickness = 2,
        Parent = getKeyButton
    })
    
    CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 0),
        Parent = getKeyButton
    })
    
    local confirmButton = CreateInstance("TextButton", {
        Name = "ConfirmButton",
        Size = UDim2.new(0, 180, 0, 50),
        Position = UDim2.new(1, 0, 0, 0),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundColor3 = Color3.fromRGB(35, 35, 35),
        BorderSizePixel = 0,
        Text = "Confirm",
        TextColor3 = textColor,
        TextSize = 18,
        Font = Enum.Font.GothamBold,
        Parent = buttonContainer
    })
    
    CreateInstance("UIStroke", {
        Color = borderColor,
        Thickness = 2,
        Parent = confirmButton
    })
    
    CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 0),
        Parent = confirmButton
    })
    
    getKeyButton.MouseButton1Click:Connect(function()
        if getKeyUrl ~= "" then
            if setclipboard then
                setclipboard(getKeyUrl)
            end
            if syn and syn.request then
                syn.request({
                    Url = getKeyUrl,
                    Method = "GET"
                })
            end
        end
    end)
    
    confirmButton.MouseButton1Click:Connect(function()
        local enteredKey = keyInput.Text
        if enteredKey == correctKey then
            if mode == "modern" then
                if iconLabel then
                    Tween(iconLabel, {ImageTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                end
                if titleLabel then
                    Tween(titleLabel, {TextTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                end
                Tween(inputKeyLabel, {TextTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                Tween(inputBorder, {BackgroundTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                Tween(keyInput, {TextTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                Tween(getKeyButton, {TextTransparency = 1, BackgroundTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                Tween(confirmButton, {TextTransparency = 1, BackgroundTransparency = 1}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                
                task.wait(0.5)
                
                Tween(mainFrame, {BackgroundTransparency = 1}, 0.6, Enum.EasingStyle.Quint, Enum.EasingDirection.In)
                
                task.wait(0.7)
                screenGui:Destroy()
                onSuccess()
            else
                local backgroundOverlay = screenGui:FindFirstChild("BackgroundOverlay")
                
                if iconLabel then
                    Tween(iconLabel, {ImageTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                end
                if titleLabel then
                    Tween(titleLabel, {TextTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                end
                Tween(inputKeyLabel, {TextTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                Tween(inputBorder, {BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                Tween(keyInput, {TextTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                Tween(getKeyButton, {TextTransparency = 1, BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                Tween(confirmButton, {TextTransparency = 1, BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                
                task.wait(0.4)
                
                Tween(mainFrame, {BackgroundTransparency = 1}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                
                if backgroundOverlay then
                    Tween(backgroundOverlay, {Size = UDim2.new(1, 0, 0, 0)}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
                end
                
                task.wait(0.6)
                screenGui:Destroy()
                onSuccess()
            end
        else
            keyInput.Text = ""
            keyInput.PlaceholderText = "Invalid Key"
            task.wait(1.5)
            keyInput.PlaceholderText = ""
        end
    end)
    
    if mode == "modern" then
        mainFrame.BackgroundTransparency = 1
        if iconLabel then iconLabel.ImageTransparency = 1 end
        if titleLabel then titleLabel.TextTransparency = 1 end
        inputKeyLabel.TextTransparency = 1
        inputBorder.BackgroundTransparency = 1
        keyInput.TextTransparency = 1
        getKeyButton.BackgroundTransparency = 1
        getKeyButton.TextTransparency = 1
        confirmButton.BackgroundTransparency = 1
        confirmButton.TextTransparency = 1
        
        task.spawn(function()
            task.wait(0.1)
            
            Tween(mainFrame, {BackgroundTransparency = 0}, 0.8, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
            
            task.wait(0.3)
            
            if iconLabel then
                Tween(iconLabel, {ImageTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            end
            if titleLabel then
                Tween(titleLabel, {TextTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            end
            Tween(inputKeyLabel, {TextTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(inputBorder, {BackgroundTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(keyInput, {TextTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(getKeyButton, {BackgroundTransparency = 0, TextTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(confirmButton, {BackgroundTransparency = 0, TextTransparency = 0}, 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        end)
        
    else
        local backgroundOverlay = CreateInstance("Frame", {
            Name = "BackgroundOverlay",
            Size = UDim2.new(1, 0, 0, 0),
            Position = UDim2.new(0, 0, 0, 0),
            BackgroundColor3 = Color3.fromRGB(15, 15, 15),
            BorderSizePixel = 0,
            ZIndex = 0,
            Parent = screenGui
        })
        
        mainFrame.BackgroundTransparency = 1
        if iconLabel then iconLabel.ImageTransparency = 1 end
        if titleLabel then titleLabel.TextTransparency = 1 end
        inputKeyLabel.TextTransparency = 1
        inputBorder.BackgroundTransparency = 1
        keyInput.TextTransparency = 1
        getKeyButton.BackgroundTransparency = 1
        getKeyButton.TextTransparency = 1
        confirmButton.BackgroundTransparency = 1
        confirmButton.TextTransparency = 1
        
        task.spawn(function()
            task.wait(0.1)
            
            Tween(backgroundOverlay, {Size = UDim2.new(1, 0, 1, 0)}, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            
            task.wait(0.3)
            
            Tween(mainFrame, {BackgroundTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            
            if iconLabel then
                Tween(iconLabel, {ImageTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            end
            if titleLabel then
                Tween(titleLabel, {TextTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            end
            Tween(inputKeyLabel, {TextTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(inputBorder, {BackgroundTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(keyInput, {TextTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(getKeyButton, {BackgroundTransparency = 0, TextTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            Tween(confirmButton, {BackgroundTransparency = 0, TextTransparency = 0}, 0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        end)
    end
end

return Catlib
